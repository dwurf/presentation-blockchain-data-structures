<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Blockchain data structures</title><meta charset="UTF-8"></meta><meta name="generator" content="Hovercraft! 1.0 http://regebro.github.com/hovercraft"></meta><link rel="stylesheet" href="css/hovercraft.css" media="all"></link><link rel="stylesheet" href="css/impressConsole.css" media="all"></link><link rel="stylesheet" href="css/highlight.css" media="all"></link><link rel="stylesheet" href="css/presentation.css" media="screen,projection"></link><script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        showProcessingMessages: false,
        messageStyle: "none",
        TeX : { extensions : ['color.js'] }
      });
    </script></head><body class="impress-not-supported"><div id="impress" data-transition-duration="300"><div class="step step-level-1" step="0" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="0" data-y="0" data-z="0"><h1 id="blockchain-data-structures">Blockchain Data Structures</h1><img src="blockchain-3212304_1920.jpg" width="800px" height="341px"></img><p>Darren Wurf</p></div><div class="step step-level-1" step="1" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="1600" data-y="0" data-z="0"><h1 id="introduction">Introduction</h1><p>So I had some questions...</p><blockquote><ul><li>What are blockchains?</li><li>What makes them different?</li><li>How do they work?</li></ul></blockquote><div class="notes"><p>Something to do with cryptocurrency?</p></div></div><div class="step step-level-1" step="2" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="3200" data-y="0" data-z="0"><h1 id="id1">Introduction</h1><p>So I had some questions...</p><blockquote><ul><li><strong>What are blockchains?</strong></li><li>What makes them different?</li><li>How do they work?</li></ul></blockquote></div><div class="step step-level-1" step="3" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="4800" data-y="0" data-z="0"><h1 id="blockchain">Blockchain</h1><p>A <strong>blockchain</strong> is a <strong>shared ledger</strong> where each new <strong>block of transactions</strong> is signed with a <strong>Nakamoto signature</strong>.</p><div class="notes"><p>Two concepts: Shared ledger, and Nakamoto signature</p></div></div><div class="step step-level-1" step="4" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="6400" data-y="0" data-z="0"><h1 id="shared-ledger">Shared ledger</h1><img src="timestamp-server.svg"></img><p>The shared ledger can be seen as a <strong>series of blocks</strong>, each of which is presented for signing when it is created. Each block consists of a <strong>set of transactions</strong>, and each block is built on the previous blocks.</p><p>Each block changes the <strong>state of the accounts</strong> by moving money around. We can create the next block by filling it with transactions, and signing it with a Nakamoto signature.</p><div class="notes"><p>I considered these other explanations as well, taken from the SALT whitepaper:
1. Executive view: A blockchain is a shared decentralized ledger, enabling business disintermediation and trustless interactions, thereby lowering transaction costs
2. The IT architect and data management view: A blockchain is a shared append-only distributed database with full replication and a cryptographic transaction permissioning model.
3. The blockchain developers and technology view: A blockchain is a peer-to-peer protocol for trust-less  execution  and  recording  of  transactions  secured by asymmetric cryptography in a consistent and immutable chain of blocks.</p></div></div><div class="step step-level-1" step="5" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="8000" data-y="0" data-z="0"><h1 id="nakamoto-signature">Nakamoto signature</h1><img src="Blockchain_landscape.svg" width="542px" height="204px"></img><p>A Nakamoto signature is a device to allow a group to <strong>agree on a shared document</strong>. To eliminate the potential for inconsistencies (disagreement), the group <strong>engages in a lottery</strong> to pick one person's version as the <strong>one true document</strong>.</p><p>The lottery is effected by all members of the group racing to create the <strong>longest hash</strong> over their copy of the document.  The longest hash <strong>wins the prize</strong> and also becomes a verifiable 'token' of the one true document for members of the group: the Nakamoto signature.</p><div class="notes"><p>The "longest hash" explanation didn't make sense until I realised they meant the hash of each block joined together.</p></div></div><div class="step step-level-1" step="6" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="9600" data-y="0" data-z="0"><h1 id="darren-s-interpretation">Darren's interpretation &#xAF;\_(&#x30C4;)_/&#xAF;</h1><p>Blockchains provide a timestamped ledger with <strong>shared-write</strong> capability to entities who <strong>do not trust each other</strong>.</p></div><div class="step step-level-1" step="7" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="11200" data-y="0" data-z="0"><h1 id="questions">Questions</h1><p>So I had some questions...</p><blockquote><ul><li>What are blockchains?</li><li><strong>What makes them different?</strong></li><li>How do they work?</li></ul></blockquote><div class="notes"><p>Is it a database?
Maybe I should compare blockchains to a database</p></div></div><div class="step step-level-1" step="8" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="12800" data-y="0" data-z="0"><h1 id="compared-to-traditional-databases">Compared to traditional databases</h1><p>Properties of blockchains:</p><ul><li>Distributed</li><li>Secure</li><li>Append-only</li><li>Eventually consistent</li></ul><div class="notes"><ul><li><dl><dt>Support for cryptographic controls down to the individual record level</dt><dd><ul><li>Participants can publish cryptographic proofs</li><li>Network rules prevent misbehaviour, such as double spending</li><li>Published blocks can't be modified</li></ul></dd></dl></li><li>Log-structured, immutable, append-only, peer-to-peer</li><li>ACID compliant? <strong>No</strong>: see <a href="http://www.ise.tu-berlin.de/fileadmin/fg308/publications/2017/2017-tai-eberhardt-klems-SALT.pdf">SALT</a></li><li>CAP theorem: Available and Partition Tolerant - eventually consistent - miners vote using Proof of Work</li></ul></div></div><div class="step step-level-1" step="9" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="14400" data-y="0" data-z="0"><h1 id="id2">Compared to traditional databases</h1><p>Downsides of blockchains</p><ul><li>Cost</li><li>Latency</li><li>Throughput</li></ul><div class="notes"><ul><li>Very high cost per transaction (power consumption / specialised compute)</li><li>Dependent on expensive consensus tools, e.g. through Proof of Work (mining)</li><li>Very high latency for transaction confirmation (e.g. 6 blocks / 1hr)</li><li>Low capacity and throughput
* Bitcoin is limited to 1MB every 10 minutes, averaging about 7 transactions per second</li><li>Requires incentives to sustain the network, e.g. block reward</li></ul></div></div><div class="step step-level-1" step="10" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="16000" data-y="0" data-z="0"><h1 id="id3">Questions</h1><p>So I had some questions...</p><blockquote><ul><li>What are blockchains?</li><li>What makes them different?</li><li><strong>How do they work?</strong></li></ul></blockquote><div class="notes"><p>Maybe looking at the data structures will help me understand</p></div></div><div class="step step-level-1" step="11" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="17600" data-y="0" data-z="0"><h1 id="the-data-structures">The data structures</h1><blockquote><ul><li>Chain</li><li>Blocks</li><li>Mempool</li><li>Transactions</li><li>Merkle trees</li></ul></blockquote></div><div class="step step-level-1" step="12" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="19200" data-y="0" data-z="0"><h1 id="the-chain">The chain</h1><img src="proof-of-work.svg"></img><ul><li>Each block contains the hash of the previous block</li><li>Blocks contain a header and some transaction data.</li></ul></div><div class="step step-level-1" step="13" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="20800" data-y="0" data-z="0"><h1 id="id4">The chain</h1><img src="proof-of-work.svg"></img><ul><li>Miners increment the nonce to change the hash of the current block</li><li>A block is published once a hash is found that meets the difficulty threshold</li><li>For example, if the difficulty is <tt>0x00001b...</tt> the miners must find a hash with lower starting bits</li></ul></div><div class="step step-level-1" step="14" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="22400" data-y="0" data-z="0"><h1 id="the-block">The block</h1><h2 id="bitcoin-block-structure">Bitcoin block structure</h2><table cellpadding="0" cellspacing="0"><tbody><tr><td><p>version</p></td><td><p>hashPrevBlock</p></td><td><p>hashMerkleRoot</p></td><td><p>nTime</p></td><td><p>nBits</p></td><td><p>nNonce</p></td></tr><tr><td colspan="2"><p>tx0 (coinbase)</p></td><td colspan="4"><p>tx1..n</p></td></tr></tbody></table><p>The first transaction is called the coinbase and is allowed to create new bitcoin.</p><pre class="highlight code c++"><span class="c1">// Bitcoin block header
</span><span class="kt">int32_t</span> <span class="n">nVersion</span><span class="p">;</span>        <span class="c1">// Block version
</span><span class="kt">char</span><span class="p">[</span><span class="mi">32</span><span class="p">]</span> <span class="n">hashPrevBlock</span><span class="p">;</span>  <span class="c1">// sha256
</span><span class="kt">char</span><span class="p">[</span><span class="mi">32</span><span class="p">]</span> <span class="n">hashMerkleRoot</span><span class="p">;</span> <span class="c1">// sha256
</span><span class="kt">uint32_t</span> <span class="n">nTime</span><span class="p">;</span>          <span class="c1">// Unix timestamp
</span><span class="kt">uint32_t</span> <span class="n">nBits</span><span class="p">;</span>          <span class="c1">// Difficulty target
</span><span class="kt">uint32_t</span> <span class="n">nNonce</span><span class="p">;</span>         <span class="c1">// Increment nonce to "mine" (change the hash)</span></pre><div class="notes"><dl><dt>Merkle trees: A kind of "cryptographic summary" of the data in the block.</dt><dd><p>They allow us to hash only the headers.</p></dd></dl></div></div><div class="step step-level-1" step="15" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="24000" data-y="0" data-z="0"><h1 id="the-mempool">The mempool</h1><img src="mempool.png"></img><ol><li>Participant signs transaction and broadcasts it to nodes</li><li>Transaction <a href="https://blockchain.info/unconfirmed-transactions">sits in the mempool</a> until a miner picks it up</li><li>Winning miner includes transaction in their published block</li></ol><div class="notes"><ul><li>To publish data on the blockchain, people sign a transaction and broadcast it to nodes on the network</li><li>The published document must satisfy the network rules (e.g. no double-spend)</li><li>There is often a fee to publish, paid to the miners</li><li>Nodes store valid, unconfirmed transactions in the <strong>mempool</strong></li></ul></div></div><div class="step step-level-1" step="16" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="25600" data-y="0" data-z="0"><h1 id="the-transaction">The transaction</h1><img src="combining-splitting-value.svg"></img><dl><dt>A transaction contains:</dt><dd><ul><li>One or more inputs (utxo)</li><li>One or more outputs</li><li>Some addresses and signatures</li></ul></dd></dl><div class="notes"><p>Inputs: Source code doesn't contain "coins" as a concept, uses utxo</p><ul><li>arbitrary value</li></ul><p>Outputs include change from the transaction</p></div></div><div class="step step-level-1" step="17" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="27200" data-y="0" data-z="0"><h1 id="id5">The transaction</h1><img src="transactions.svg"></img><ul><li>Transactions track the history of a "coin" (utxo)</li><li>Coins are passed from owner to owner</li></ul><div class="notes"><p>Cryptographic proof of ownership</p><p>Owner 1 wants to send to owner 2:</p><ul><li>First block: Owner 1's proof that owner 0 send them the coin</li><li>Second block: Owner 1 creates the transaction, including:</li></ul><p>** Recipient's public key</p><p>** Owner 1's Digital Signature of:</p><p>** * Proof of ownership (previous transaction, first block)</p><p>** * Recipient's public key</p><p>Lose your private key -&gt; lose your money</p><p>Private key stolen -&gt; lose your money</p></div></div><div class="step step-level-1" step="18" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="28800" data-y="0" data-z="0"><h1 id="the-merkle-tree">The Merkle Tree</h1><table cellpadding="0" cellspacing="0"><tbody><tr><td><p>version</p></td><td><p>hashPrevBlock</p></td><td><p><strong>hashMerkleRoot</strong></p></td><td><p>nTime</p></td><td><p>nBits</p></td><td><p>nNonce</p></td></tr></tbody></table><ul><li>The merkle tree summarises the data (transactions) stored in the block</li><li>The root of the tree is stored in the block header</li><li>Only the header of the block is hashed by miners, individual transactions are not</li></ul><div class="notes"><p>Complex topic. Important points:
* Only the block header is hashed
* Transactions can be pruned
* Merkle tree is magic that can prove a transaction belongs to a block header</p></div></div><div class="step step-level-1" step="19" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="30400" data-y="0" data-z="0"><h1 id="id6">The Merkle Tree</h1><img src="Hash_Tree.svg" width="800px" height="509px"></img><ul><li>Leaf nodes are the hash of the data blocks</li><li>The intermediate nodes are the hash of their children</li><li>The root is stored in the block header</li></ul></div><div class="step step-level-1" step="20" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="32000" data-y="0" data-z="0"><h1 id="compacting-old-blocks">Compacting old blocks</h1><img src="reclaiming-disk-space.svg" width="800px" height="509px"></img><ul><li>Historic transactions can be pruned to save space</li><li>Nodes can store just the parent node for branches they aren't interested in</li><li>Blocks and transactions can still be validated using the parent nodes</li></ul></div><div class="step step-level-1" step="21" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="33600" data-y="0" data-z="0"><h1 id="simplified-payment-verification">Simplified Payment Verification</h1><img src="simplified-payment-verification.svg" width="800px" height="315px"></img><ul><li>Full nodes store the entire blockchain history</li><li>SPV allows users to use the blockchain without storing the full history</li><li>A mobile wallet can download just the block headers and relevant branches</li></ul></div><div class="step step-level-1" step="22" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="35200" data-y="0" data-z="0"><h1 id="learnings">Learnings</h1><ul><li>Blockchains are <strong>weird!</strong></li><li>Blockchains suck at <strong>storing data</strong></li><li>Blockchains are great at <strong>verifying history</strong></li></ul></div><div class="step step-level-1" step="23" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="36800" data-y="0" data-z="0"><h1 id="links">Links</h1><ul><li>Bitcoin Whitepaper: <a href="https://nakamotoinstitute.org/bitcoin/">https://nakamotoinstitute.org/bitcoin/</a> (read the references too!)</li><li>Explanantion (user-centric): <a href="https://www.vpnmentor.com/blog/ultimate-guide-bitcoin/">https://www.vpnmentor.com/blog/ultimate-guide-bitcoin/</a></li><li>Protocol structures: <a href="https://en.bitcoin.it/wiki/Protocol_documentation#Common_structures">https://en.bitcoin.it/wiki/Protocol_documentation#Common_structures</a></li><li>Properties of blockchains: SALT: <a href="http://www.ise.tu-berlin.de/fileadmin/fg308/publications/2017/2017-tai-eberhardt-klems-SALT.pdf">http://www.ise.tu-berlin.de/fileadmin/fg308/publications/2017/2017-tai-eberhardt-klems-SALT.pdf</a></li><li>Real-time transaction view (mempool): <a href="https://blockchain.info/unconfirmed-transactions">https://blockchain.info/unconfirmed-transactions</a></li><li>Real-time transaction visualisation: <a href="https://bitbonkers.com/">https://bitbonkers.com/</a></li></ul></div></div><div id="hovercraft-help"><table><tr><th>Space</th><td>Forward</td></tr><tr><th>Right, Down, Page Down</th><td>Next slide</td></tr><tr><th>Left, Up, Page Up</th><td>Previous slide</td></tr><tr><th>G</th><td>Go to slide number</td></tr><tr><th>P</th><td>Open presenter console</td></tr><tr><th>H</th><td>Toggle this help</td></tr></table></div><script type="text/javascript" src="js/impress.js"></script><script type="text/javascript" src="js/impressConsole.js"></script><script type="text/javascript" src="js/hovercraft.js"></script></body></html>