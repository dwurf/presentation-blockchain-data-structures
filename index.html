<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Blockchain data structures</title><meta charset="UTF-8"></meta><meta name="generator" content="Hovercraft! 1.0 http://regebro.github.com/hovercraft"></meta><link rel="stylesheet" href="css/hovercraft.css" media="all"></link><link rel="stylesheet" href="css/impressConsole.css" media="all"></link><link rel="stylesheet" href="css/highlight.css" media="all"></link><link rel="stylesheet" href="css/presentation.css" media="screen,projection"></link><script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        showProcessingMessages: false,
        messageStyle: "none",
        TeX : { extensions : ['color.js'] }
      });
    </script></head><body class="impress-not-supported"><div id="impress" data-transition-duration="300"><div class="step step-level-1" step="0" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="0" data-y="0" data-z="0"><h1 id="blockchain-data-structures">Blockchain Data Structures</h1><img src="blockchain-3212304_1920.jpg" width="800px" height="341px"></img><p>Darren Wurf</p></div><div class="step step-level-1" step="1" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="1600" data-y="0" data-z="0"><h1 id="introduction">Introduction</h1><p>&lt;h1&gt;BLAH&lt;/h1&gt;</p><p>Introductory material should set the expectations of this talk, i.e. we will be talking about blockchains from a software engineering perspective, to demystify them and better understand what they actually do.</p><p>Bitcoin will be used for the examples unless noted otherwise.</p></div><div class="step step-level-1" step="2" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="3200" data-y="0" data-z="0"><h1 id="blockchain">Blockchain</h1><p>The <strong>blockchain</strong> is a <strong>shared ledger</strong> where each new <strong>block of transactions</strong> is signed with a <strong>Nakamoto signature</strong>.</p></div><div class="step step-level-1" step="3" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="4800" data-y="0" data-z="0"><h1 id="shared-ledger">Shared ledger</h1><img src="timestamp-server.svg"></img><ul><li>Allows <strong>shared-write</strong> to a <strong>distributed ledger</strong> amongst <strong>mutually distrusting parties</strong></li></ul><p>1. Executive view: A blockchain is a shared decentralized ledger, enabling
business disintermediation and trustless interactions, thereby lowering
transaction costs</p><p>The shared ledger can be seen as a series of blocks, each of which is a single document presented for signature. Each block consists of a set of transactions built on the previous set. Each succeeding block changes the state of the accounts by moving money around; so given any particular state we can create the next block by filling it with transactions that do those money moves, and signing it with a Nakamoto signature.</p><p>1. A blockchain is a peer-to-peer protocol for trust-
less  execution  and  recording  of  transactions  se-
cured by asymmetric cryptography in a consistent
and immutable chain of blocks &#x2013; the blockchain
developers and technology view.</p><p>2. A blockchain is a shared append-only distributed
database with full replication and a cryptographic
transaction permissioning model &#x2013; the IT architect
and data management view.</p></div><div class="step step-level-1" step="4" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="6400" data-y="0" data-z="0"><h1 id="nakamoto-signature">Nakamoto signature</h1><p>A Nakamoto signature is a device to allow a group to agree on a shared document. To eliminate the potential for inconsistencies (disagreement), the group engages in a lottery to pick one person's version as the one true document. That lottery is effected by all members of the group racing to create the longest hash over their copy of the document. The longest hash wins the prize and also becomes a verifiable 'token' of the one true document for members of the group: the Nakamoto signature.</p></div><div class="step step-level-1" step="5" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="8000" data-y="0" data-z="0"><h1 id="key-points-to-get-across">Key points to get across</h1><blockquote><ul><li>Blockchains provide a ledger with <strong>shared-write</strong> capability to a bunch of entities who <strong>do not trust each other</strong></li></ul></blockquote><h2 id="blockchains-enable-cryptocurrency">Blockchains enable cryptocurrency</h2><p>Cryptocurrency Bitcoin had a very specific set of requirements that was not solved by any technology available at the time. Specifically, there was no way to prevent double-spending of digital currency (including traditional currencies) without a trusted intermediary maintaining and monitoring a transaction ledger.</p><p>Previous attempts at designing a digital currency had not solved this problem, but one design <strong>b-money</strong> proposed a solution in the form of a global timestamp server, "kind of like usenet".</p><p>Bitcoin solved this problem by introducing the concept of a global, peer-to-peer timestamp network where anyone could record transactions, but the network itself would not allowing double-spending.</p></div><div class="step step-level-1" step="6" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="9600" data-y="0" data-z="0"><h1 id="compared-to-traditional-databases">Compared to traditional databases</h1><p>Properties of blockchains:</p><blockquote><ul><li>Log-structured, immutable, append-only, peer-to-peer</li><li>Support for cryptographic controls down to the individual record level</li><li>ACID compliant? <strong>No</strong>: see <a href="http://www.ise.tu-berlin.de/fileadmin/fg308/publications/2017/2017-tai-eberhardt-klems-SALT.pdf">SALT</a></li><li>CAP theorem: AP - eventually consistent - miners vote using Proof of Work</li></ul></blockquote></div><div class="step step-level-1" step="7" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="11200" data-y="0" data-z="0"><h1 id="id1">Compared to traditional databases</h1><p>Downsides of blockchains</p><blockquote><ul><li>Very high cost per transaction (power consumption / specialised compute)</li><li>Very high latency for transaction confirmation (e.g. 6 blocks / 1hr)</li><li>Low capacity and throughput
* Bitcoin is limited to 1MB every 10 minutes, averaging about 7 transactions per second</li><li>Dependent on expensive consensus tools, e.g. through Proof of Work (mining)</li><li>Requires incentives to sustain the network, e.g. block reward</li></ul></blockquote></div><div class="step step-level-1" step="8" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="12800" data-y="0" data-z="0"><h1 id="blockchains-are-a-distributed-ledger">Blockchains are a <strong>distributed ledger</strong></h1><p>Evolution of the ledger concept. Not sure how important this is for an engineering discussion. Are they a ledger or do they just allow for a ledger to be built on top of them? Without the ledger concept how would you pay miners to run and secure the network?</p></div><div class="step step-level-1" step="9" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="14400" data-y="0" data-z="0"><h1 id="questions-arising-from-the-above">Questions arising from the above</h1><blockquote><ul><li>What are the properties of these data structure?</li><li>How do they compare to other data structures?</li><li><dl><dt>What is the key innovation that blockchain brings to the table?</dt><dd><ul><li>From a data structure perspective</li><li>From a software perspective (Don't focus on this too much, the purpose is to explain why the data structure is new)</li></ul></dd></dl></li></ul></blockquote></div><div class="step step-level-1" step="10" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="16000" data-y="0" data-z="0"><h1 id="the-data-structures">The data structures</h1><blockquote><ul><li>Chain</li><li>Blocks
* Hashes and nonce
* Transactions (or whatever goes in the block for this blockchain)
* Reward</li><li>Merkle trees</li><li>Mempool</li><li>Structures used for peer to peer communication</li></ul></blockquote></div><div class="step step-level-1" step="11" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="17600" data-y="0" data-z="0"><h1 id="the-chain">The chain</h1><img src="proof-of-work.svg"></img><ul><li>Each block contains the hash of the previous block</li><li>Blocks contain a header and some transaction data.</li><li>The first transaction is called the coinbase and is allowed to create new bitcoin.</li></ul></div><div class="step step-level-1" step="12" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="19200" data-y="0" data-z="0"><h1 id="id2">The chain</h1><img src="proof-of-work.svg"></img><ul><li>Miners increment the nonce to change the hash of the current block</li><li>A block is published once a hash is found that meets the difficulty threshold</li><li>For example, if the difficulty is <tt>0x00001b...</tt> the miners must find a hash with lower starting bits</li></ul></div><div class="step step-level-1" step="13" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="20800" data-y="0" data-z="0"><h1 id="the-block">The block</h1><table cellpadding="0" cellspacing="0"><tbody><tr><td><p>version</p></td><td><p>hashPrevBlock</p></td><td><p>hashMerkleRoot</p></td><td><p>nTime</p></td><td><p>nBits</p></td><td><p>nNonce</p></td></tr><tr><td colspan="2"><p>tx0 (coinbase)</p></td><td colspan="4"><p>tx1..n</p></td></tr></tbody></table><pre class="highlight code c++"><span class="c1">// Bitcoin block header
</span><span class="kt">int32_t</span> <span class="n">nVersion</span><span class="p">;</span>        <span class="c1">// Block version
</span><span class="kt">char</span><span class="p">[</span><span class="mi">32</span><span class="p">]</span> <span class="n">hashPrevBlock</span><span class="p">;</span>  <span class="c1">// sha256
</span><span class="kt">char</span><span class="p">[</span><span class="mi">32</span><span class="p">]</span> <span class="n">hashMerkleRoot</span><span class="p">;</span> <span class="c1">// sha256
</span><span class="kt">uint32_t</span> <span class="n">nTime</span><span class="p">;</span>          <span class="c1">// Unix timestamp
</span><span class="kt">uint32_t</span> <span class="n">nBits</span><span class="p">;</span>          <span class="c1">// Difficulty target
</span><span class="kt">uint32_t</span> <span class="n">nNonce</span><span class="p">;</span>         <span class="c1">// Increment nonce to "mine" (change the hash)</span></pre><div class="notes"><dl><dt>Merkle trees: A kind of "cryptographic summary" of the data in the block.</dt><dd><p>They allow us to hash only the headers.</p></dd></dl></div></div><div class="step step-level-1" step="14" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="22400" data-y="0" data-z="0"><h1 id="the-mempool">The Mempool</h1><ul><li>To publish data on the blockchain, people sign a document (e.g. transaction) and broadcast it to nodes on the network</li><li>The published document must satisfy the network rules (e.g. no double-spend)</li><li>There is often a fee to publish, paid to the miners</li><li>Nodes store valid, <a href="https://blockchain.info/unconfirmed-transactions">unconfirmed transactions</a> in the <strong>mempool</strong></li></ul></div><div class="step step-level-1" step="15" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="24000" data-y="0" data-z="0"><h1 id="the-transaction">The Transaction</h1><img src="transactions.svg"></img><ul><li>A transaction is a signature of the inputs and outputs of existing coins</li><li>Inputs are ?previous transactions?</li><li>Outputs are ?locking script?</li><li>TODO: look at the source code</li></ul></div><div class="step step-level-1" step="16" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="25600" data-y="0" data-z="0"><h1 id="the-merkle-tree">The Merkle Tree</h1><table cellpadding="0" cellspacing="0"><tbody><tr><td><p>version</p></td><td><p>hashPrevBlock</p></td><td><p><strong>hashMerkleRoot</strong></p></td><td><p>nTime</p></td><td><p>nBits</p></td><td><p>nNonce</p></td></tr></tbody></table><ul><li>The merkle tree summarises the data (transactions) stored in the block</li><li>The root of the tree is stored in the block header</li><li>Only the header of the block is hashed by miners, individual transactions are not</li></ul></div><div class="step step-level-1" step="17" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="27200" data-y="0" data-z="0"><h1 id="id3">The Merkle Tree</h1><img src="Hash_Tree.svg" width="800px" height="509px"></img><ul><li>Leaf nodes are the hash of the data blocks</li><li>The intermediate nodes are the hash of their children</li><li>The root is stored in the block header</li></ul></div><div class="step step-level-1" step="18" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="28800" data-y="0" data-z="0"><h1 id="compacting-old-blocks">Compacting old blocks</h1><img src="reclaiming-disk-space.svg" width="800px" height="509px"></img><ul><li>Historic transactions can be pruned to save space</li><li>Nodes can store just the parent node for branches they aren't interested in</li><li>Blocks and transactions can still be validated using the parent nodes</li></ul></div><div class="step step-level-1" step="19" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="30400" data-y="0" data-z="0"><h1 id="simplified-payment-verification">Simplified Payment Verification</h1><img src="simplified-payment-verification.svg" width="800px" height="315px"></img><ul><li>Full nodes store the entire blockchain history</li><li>SPV allows users to use the blockchain without storing the full history</li><li>A mobile wallet can download just the block headers and relevant branches</li></ul></div><div class="step step-level-1" step="20" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="32000" data-y="0" data-z="0"><h1 id="id4">The Mempool</h1></div><div class="step step-level-1" step="21" data-x="32000" data-y="1000" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-z="0"><h1 id="what-can-we-actually-do-with-blockchains">What can we actually do with blockchains?</h1><ul><li>Record transactions (obviously)</li><li>A distributed computer - all nodes compute the exact same value, which enables:</li><li>Smart contracts: the ability to</li><li>Proof-of-possession for some data at some time e.g. <a href="https://canyouproveit.io/">https://canyouproveit.io/</a></li><li>Creation of automatic markets, particularly for high-volume, low-value transactions</li></ul></div><div class="step step-level-1" step="22" data-rotate-x="0" data-rotate-y="0" data-rotate-z="90" data-scale="1" data-x="32000" data-y="2000" data-z="0"><h1 id="code">Code</h1><p>From src/primitives/block.h:</p><p>Nodes collect new transactions into a block, hash them into a hash tree,
and scan through nonce values to make the block's hash satisfy proof-of-work
requirements.  When they solve the proof-of-work, they broadcast the block
to everyone and the block is added to the block chain.  The first transaction
in the block is a special one that creates a new coin owned by the creator
of the block.</p><h1 id="links">Links</h1><ul><li>Whitepaper: <a href="https://nakamotoinstitute.org/bitcoin/">https://nakamotoinstitute.org/bitcoin/</a> (read the references too!)</li><li>Explanantion: <a href="https://www.vpnmentor.com/blog/ultimate-guide-bitcoin/">https://www.vpnmentor.com/blog/ultimate-guide-bitcoin/</a></li><li>Protocol structures: <a href="https://en.bitcoin.it/wiki/Protocol_documentation#Common_structures">https://en.bitcoin.it/wiki/Protocol_documentation#Common_structures</a></li><li>Properties of blockchains: SALT: <a href="http://www.ise.tu-berlin.de/fileadmin/fg308/publications/2017/2017-tai-eberhardt-klems-SALT.pdf">http://www.ise.tu-berlin.de/fileadmin/fg308/publications/2017/2017-tai-eberhardt-klems-SALT.pdf</a></li><li>Real-time transaction view: <a href="https://blockchain.info/unconfirmed-transactions">https://blockchain.info/unconfirmed-transactions</a></li><li>Real-time transaction visualisation: <a href="https://bitbonkers.com/">https://bitbonkers.com/</a></li></ul><h1 id="glossary">Glossary</h1><blockquote><ul><li>Byzantine fault tolerance - resistance to failures in a distributed system</li><li>Merkle trees</li></ul></blockquote></div></div><div id="hovercraft-help"><table><tr><th>Space</th><td>Forward</td></tr><tr><th>Right, Down, Page Down</th><td>Next slide</td></tr><tr><th>Left, Up, Page Up</th><td>Previous slide</td></tr><tr><th>G</th><td>Go to slide number</td></tr><tr><th>P</th><td>Open presenter console</td></tr><tr><th>H</th><td>Toggle this help</td></tr></table></div><script type="text/javascript" src="js/impress.js"></script><script type="text/javascript" src="js/impressConsole.js"></script><script type="text/javascript" src="js/hovercraft.js"></script></body></html>